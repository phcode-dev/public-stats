<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download Stats Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div style="width:80%; margin: 20px auto; height: 50vh;">
    <canvas id="downloadsChart"></canvas>
</div>
<div style="width:80%; margin: 20px auto; height: 50vh;">
    <canvas id="platformChart"></canvas>
</div>
<div style="width:80%; margin: 20px auto; height: 50vh;">
    <canvas id="installerChart"></canvas>
</div>
<div style="width:80%; margin: 20px auto; height: 50vh;">
    <canvas id="updaterChart"></canvas>
</div>
<script>
    const data = {
        "publishDate": "2024-05-26T09:46:28Z",
        "timeSeries": [
            "20-08-2024", "21-08-2024", "22-08-2024", "23-08-2024", "24-08-2024",
            "25-08-2024", "26-08-2024", "27-08-2024", "28-08-2024", "29-08-2024"
        ],
        "LINUX_X64_GLIBC_2_31_INSTALLER": [17, 20, 15, 18, 22, 25, 27, 30, 28, 32],
        "LINUX_X64_GLIBC_2_35_INSTALLER": [1744, 1760, 1790, 1800, 1820, 1840, 1860, 1880, 1890, 1900],
        "MAC_M1_INSTALLER": [3795, 3800, 3850, 3900, 3950, 4000, 4050, 4100, 4150, 4200],
        "WINDOWS_X64_INSTALLER": [6013, 6050, 6100, 6150, 6200, 6250, 6300, 6350, 6400, 6450],
        "WINDOWS_X64_UPDATER": [1570, 1600, 1620, 1640, 1660, 1680, 1700, 1720, 1740, 1760],
        "MAC_X64_INSTALLER": [2037, 2050, 2070, 2090, 2100, 2120, 2140, 2160, 2180, 2200],
        "MAC_M1_UPDATER": [636, 640, 645, 650, 655, 660, 665, 670, 675, 680],
        "MAC_X64_UPDATER": [204, 210, 220, 230, 240, 250, 260, 270, 280, 290],
        "totalDownloads": [16172, 16200, 16250, 16300, 16350, 16400, 16450, 16500, 16550, 16600]
    };

    // Calculate platform aggregates
    function sumDownloads(dataArray) {
        return dataArray[0].map((_, index) => dataArray.reduce((sum, current) => sum + current[index], 0));
    }

    const linuxInstaller = sumDownloads([data.LINUX_X64_GLIBC_2_31_INSTALLER, data.LINUX_X64_GLIBC_2_35_INSTALLER]);
    const macInstaller = sumDownloads([data.MAC_M1_INSTALLER, data.MAC_X64_INSTALLER]);
    const windowsInstaller = sumDownloads([data.WINDOWS_X64_INSTALLER]);

    const linuxUpdater = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]; // No Linux updaters in the example data
    const macUpdater = sumDownloads([data.MAC_M1_UPDATER, data.MAC_X64_UPDATER]);
    const windowsUpdater = sumDownloads([data.WINDOWS_X64_UPDATER]);

    const ctx1 = document.getElementById('downloadsChart').getContext('2d');
    const downloadsChart = new Chart(ctx1, {
        type: 'line',
        data: createChartData(data, ''),
        options: createChartOptions()
    });

    const ctx2 = document.getElementById('platformChart').getContext('2d');
    const platformChart = new Chart(ctx2, {
        type: 'line',
        data: {
            labels: data.timeSeries,
            datasets: [
                { label: 'Linux Downloads', data: linuxInstaller, borderColor: getRandomColor(), tension: 0.1 },
                { label: 'Mac Downloads', data: macInstaller, borderColor: getRandomColor(), tension: 0.1 },
                { label: 'Windows Downloads', data: windowsInstaller, borderColor: getRandomColor(), tension: 0.1 },
                { label: 'Total Downloads', data: data.totalDownloads, borderColor: '#000000', tension: 0.1 }
            ]
        },
        options: createChartOptions()
    });

    const ctx3 = document.getElementById('installerChart').getContext('2d');
    const installerChart = new Chart(ctx3, {
        type: 'line',
        data: {
            labels: data.timeSeries,
            datasets: [
                { label: 'Linux Installers', data: linuxInstaller, borderColor: getRandomColor(), tension: 0.1 },
                { label: 'Mac Installers', data: macInstaller, borderColor: getRandomColor(), tension: 0.1 },
                { label: 'Windows Installers', data: windowsInstaller, borderColor: getRandomColor(), tension: 0.1 }
            ]
        },
        options: createChartOptions()
    });

    const ctx4 = document.getElementById('updaterChart').getContext('2d');
    const updaterChart = new Chart(ctx4, {
        type: 'line',
        data: {
            labels: data.timeSeries,
            datasets: [
                { label: 'Mac Updaters', data: macUpdater, borderColor: getRandomColor(), tension: 0.1 },
                { label: 'Windows Updaters', data: windowsUpdater, borderColor: getRandomColor(), tension: 0.1 }
            ]
        },
        options: createChartOptions()
    });

    function createChartData(data, labelPrefix) {
        return {
            labels: data.timeSeries,
            datasets: Object.keys(data).filter(key => key !== "timeSeries" && key !== "publishDate").map(key => ({
                label: `${labelPrefix} - ${key.replace(/_/g, ' ')}`,
                data: data[key],
                borderColor: getRandomColor(),
                tension: 0.1
            }))
        };
    }

    function createChartOptions() {
        return {
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            plugins: {
                legend: {
                    position: 'top',
                }
            },
            responsive: true,
            maintainAspectRatio: false
        };
    }

    function getRandomColor() {
        const letters = '0123456789ABCDEF';
        let color = '#';
        for (let i = 0; i < 6; i++) {
            color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
    }
</script>
</body>
</html>
